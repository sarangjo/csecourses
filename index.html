<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>UW CSE Courses</title>
        <script type="text/javascript" src="d3/d3.min.js"></script>
        <script src="http://d3js.org/queue.v1.min.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <script type="text/javascript">
            var w = 640;
            var h = 480;

            var filenames = ["csecourses/testcourses.json", "csecourses/testlinks.json"];

            loadFiles(filenames);

            /**
             * Loads the given list of file names. Calls onFilesLoaded when files are 
             * done loading.
             */
            function loadFiles(filenames) {
                var q = queue();

                filenames.forEach(function(d) {
                    q.defer(d3.json, d);
                });
                q.awaitAll(onFilesLoaded);
            }

            /**
             * Called when the JSON files have been loaded.
             */
            function onFilesLoaded(err, results) {
                var nodes = results[0];
                var links = results[1];

                setPositions(nodes);

                var svg = d3.select("body").append("svg")
                    .attr("width", w)
                    .attr("height", h);


                var force = d3.layout.force()
                    .size([w, h])
                    .nodes(nodes)
                    .links(links);

                // Attaching nodes and links to the visualization
                var link = svg.selectAll(".link")
                    .data(links).enter()
                    .append("line")
                    .attr("class", "link");

                var node = svg.selectAll(".node")
                    .data(nodes).enter()
                    .append("circle")
                    .attr("class", "node");

                force.on('end', function() {
                    node.attr('r', w/30)
                        .attr('cx', function(d) { return d.x; })
                        .attr('cy', function(d) { return d.y; });
                
                    link.attr('x1', function(d) { return d.source.x; })
                        .attr('y1', function(d) { return d.source.y; })
                        .attr('x2', function(d) { return d.target.x; })
                        .attr('y2', function(d) { return d.target.y; });

                    console.log("Done!");
                });

                force.start();
            }

            /**
             * Sets the positions of the given nodes.
             */
            function setPositions(nodes) {
                for(var i = 0; i < 3; i++) {
                    var n = nodes[i];
                    console.log(n);
                    n.x = 200 + 50*i;
                    n.y = 200;
                    console.log(n);
                }

                nodes[3].x = 250;
                nodes[3].y = 300;
                console.log(nodes[3]);

                nodes.forEach(function(n) {
                    n.fixed = true;
                });
            }
        </script>
        <p>Hello World!</p>
    </body>
</html>